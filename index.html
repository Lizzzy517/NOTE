<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your Journey Awaits, Addie!</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Cormorant+Garamond:wght@400;600&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --blue-sky-light: #87CEEB; /* 天藍色 */
      --blue-sky-dark: #6495ED;  /* 深一點的藍 */
      --cloud-white: #F0F8FF;   /* 雲白色 */
      --text: rgba(255,255,255,.92);
      --gold: #d8b25c;
      --radius: 22px;
      --display: "Cinzel", serif;
      --mono: "Orbitron", monospace; /* 登機證風格字體 */
    }

    body {
      margin: 0; font-family: "Cormorant Garamond", serif; color: var(--text);
      display: flex; align-items: center; justify-content: center; min-height: 100vh;
      background: linear-gradient(to bottom right, var(--blue-sky-light), var(--blue-sky-dark));
      overflow: hidden; /* 隱藏滾動條 */
      position: relative;
    }

    /* 雲朵效果 */
    .cloud {
      position: absolute;
      background: var(--cloud-white);
      border-radius: 50%;
      box-shadow: 0 0 25px rgba(255,255,255,0.4);
      opacity: 0.8;
      filter: blur(8px);
    }
    .cloud:nth-child(1) { width: 120px; height: 70px; top: 10%; left: 15%; animation: floatCloud 25s infinite linear; }
    .cloud:nth-child(2) { width: 180px; height: 90px; top: 25%; right: 10%; animation: floatCloud 30s infinite linear reverse; }
    .cloud:nth-child(3) { width: 90px; height: 50px; bottom: 20%; left: 25%; animation: floatCloud 20s infinite linear; }
    .cloud:nth-child(4) { width: 200px; height: 100px; top: 5%; right: 30%; animation: floatCloud 28s infinite linear; }
    .cloud:nth-child(5) { width: 150px; height: 80px; bottom: 10%; right: 15%; animation: floatCloud 23s infinite linear reverse; }
    @keyframes floatCloud {
      0% { transform: translateX(0); }
      50% { transform: translateX(20px); }
      100% { transform: translateX(0); }
    }

    .wrap {
      width: min(860px, 95%);
      position: relative;
      z-index: 10;
      padding: 20px; /* 增加內邊距，讓內容不頂邊 */
    }

    .card-container {
      background: rgba(255,255,255,0.1); /* 半透明，看得到背景雲朵 */
      border-radius: var(--radius);
      padding: 28px;
      border: 1px solid rgba(255,255,255,0.4);
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
      backdrop-filter: blur(5px); /* 模糊背景，更像機艙窗外 */
      -webkit-backdrop-filter: blur(5px);
    }

    /* Boarding Pass Style */
    #boardingPass {
      background: linear-gradient(160deg, #F0F8FF, #E0EBF5);
      color: #333;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      max-width: 400px;
      margin: 0 auto;
      text-align: left;
      font-family: var(--mono);
      position: relative;
      overflow: hidden;
      border: 1px dashed rgba(0,0,0,0.1);
    }
    #boardingPass::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="50" y="50" font-family="Arial" font-size="20" fill="%23e0e0e0" text-anchor="middle" dominant-baseline="middle" transform="rotate(-45 50 50)">BOARDING PASS</text></svg>');
      background-size: 150px 150px;
      opacity: 0.1;
      z-index: 0;
    }
    .bp-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 20px;
      border-bottom: 1px solid rgba(0,0,0,0.1);
      padding-bottom: 15px;
    }
    .bp-header img { height: 30px; }
    .bp-header h2 { font-family: var(--display); font-size: 20px; color: var(--blue-sky-dark); margin: 0; }
    .bp-info { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
    .bp-field { font-size: 12px; }
    .bp-field span { display: block; font-size: 18px; font-weight: bold; color: #000; margin-top: 3px; }
    .bp-message { text-align: center; font-size: 14px; color: #555; margin-bottom: 15px; }
    .barcode { width: 80%; height: 50px; background: repeating-linear-gradient(90deg, black 0 2px, white 2px 4px); margin: 0 auto 15px; }
    
    .bp-button {
      text-align: center;
      margin-top: 20px;
    }
    .bp-button button {
      background: linear-gradient(45deg, var(--gold), #f9d98e);
      color: #333;
      padding: 12px 30px;
      border-radius: 8px;
      font-weight: bold;
      font-family: var(--mono);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
      font-size: 16px;
    }
    .bp-button button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    /* Airplane Scene */
    #airplaneScene {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 400px;
      padding: 20px;
      text-align: center;
    }
    .airplane {
      width: 150px;
      height: auto;
      transform: rotate(5deg);
      margin-bottom: 30px;
      filter: drop-shadow(5px 5px 10px rgba(0,0,0,0.3));
      animation: flyPlane 30s infinite linear;
    }
    @keyframes flyPlane {
      0% { transform: translate(-10px, 0px) rotate(5deg); }
      25% { transform: translate(10px, -5px) rotate(4deg); }
      50% { transform: translate(-10px, 0px) rotate(5deg); }
      75% { transform: translate(10px, 5px) rotate(6deg); }
      100% { transform: translate(-10px, 0px) rotate(5deg); }
    }

    .checkin-status {
      font-family: var(--display);
      font-size: 24px;
      color: var(--gold);
      margin-bottom: 15px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    .checkin-subtext {
      font-size: 16px;
      color: rgba(255,255,255,0.9);
      max-width: 400px;
      margin-bottom: 30px;
    }

    /* Existing Styles (adjusted for new theme) */
    #title { font-family: var(--display); color: var(--gold); text-shadow: 2px 2px 5px rgba(0,0,0,0.4); margin: 0;}
    .countdown, .journey-wrap {
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 15px;
      margin-bottom: 20px;
      border: 1px solid rgba(255,255,255,0.2);
      box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
    }
    .tile { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); }
    .num { color: var(--cloud-white); }
    .label { color: var(--gold); }
    .progress-meta { color: var(--cloud-white); }
    #travelStatus { color: rgba(255,255,255,0.8); }

    .fateRevealTitle { font-family: var(--display); font-size: 20px; color: var(--gold); margin-bottom: 8px; }
    .fateRevealMeta { font-size: 14px; white-space: pre-line; color: rgba(255,255,255,0.9); }
    #openingText { text-align: center; white-space: pre-line; font-style: italic; margin-bottom: 25px; color: var(--cloud-white); }
    .primary { background: linear-gradient(135deg, var(--gold), #f9d98e); color: #333; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
    .primary:hover { transform: scale(1.03); }

    #flow { display: none; } /* 預設隱藏，待 check-in 後才顯示 */
  </style>
</head>
<body>
  <div class="cloud"></div>
  <div class="cloud"></div>
  <div class="cloud"></div>
  <div class="cloud"></div>
  <div class="cloud"></div>

  <main class="wrap">
    <section class="card-container">
      <h1 id="mainTitle" style="font-family: var(--display); color: var(--gold); margin:0; text-align: center; margin-bottom: 30px;">Your Journey Awaits</h1>
      
      <div id="boardingPass">
        <div class="bp-header">
          <h2>BOARDING PASS</h2>
          <img src="https://www.flaticon.com/svg/v2/icons/svg/1057/1057088.svg" alt="Airplane Icon" style="filter: invert(40%) sepia(80%) saturate(1000%) hue-rotate(200deg) brightness(90%);">
        </div>
        <div class="bp-info">
          <div class="bp-field">FROM<span>TAIWAN (TPE)</span></div>
          <div class="bp-field">TO<span>EUROPE (???)</span></div>
          <div class="bp-field">PASSENGER<span>ADDIE</span></div>
          <div class="bp-field">DATE<span>MAR 06, 2026</span></div>
          <div class="bp-field">FLIGHT<span>LOVELINE-0306</span></div>
          <div class="bp-field">SEAT<span>AISLE A</span></div>
        </div>
        <p class="bp-message">Your exclusive journey is about to begin. Please proceed to check-in.</p>
        <div class="barcode"></div>
        <div class="bp-button">
          <button id="startJourneyBtn">START JOURNEY</button>
        </div>
      </div>

      <div id="airplaneScene">
        <img src="https://www.flaticon.com/svg/v2/icons/svg/1057/1057088.svg" alt="Airplane" class="airplane">
        <h2 class="checkin-status">尚未開放 Check-in</h2>
        <p class="checkin-subtext">親愛的 Addie，飛行員正在確認航線與機艙壓力，請稍候。當飛行準備完成，艙門就會為妳開啟。</p>
        <div id="countdownBeforeOpen" style="font-family: var(--mono); font-size: 16px; color: rgba(255,255,255,0.7); margin-top: 15px;">倒數中...</div>
      </div>

      <div id="flow">
        <h1 id="title" style="font-family: var(--display); color: var(--gold); margin:0; text-align: center; margin-bottom: 20px;">Hi, Addie!</h1>
        <div class="countdown">
          <div class="tile"><span class="num" id="d">0</span><span class="label">days</span></div>
          <div class="tile"><span class="num" id="h">0</span><span class="label">hours</span></div>
          <div class="tile"><span class="num" id="m">0</span><span class="label">mins</span></div>
          <div class="tile"><span class="num" id="s">0</span><span class="label">secs</span></div>
        </div>
        <div class="journey-wrap">
          <div class="progress-meta">EUROPE SURPRISE LOADING: <span id="percentText">0</span>%</div>
          <div class="progress-bar"><div class="progress-fill" id="barFill"></div></div>
          <p id="travelStatus">?? 正在搜尋衛星訊號...</p>
        </div>
        
        <p id="openingText" style="text-align:center; white-space: pre-line; font-style: italic; margin-bottom: 25px;"></p>
        <div class="cards">
          <div class="fate" id="cardA" onclick="handlePick('A')">
            <div class="fateInner"><div class="fateFace fateFront"><p class="fateTitle">Card A</p><span style="font-size:12px;color:var(--gold)">? tap to pick</span></div>
            <div class="fateFace fateBack"><div class="pickBadge">YOU CHOSE</div><p class="fateRevealTitle">A CUT · 國賓</p><p class="fateRevealMeta" id="metaA"></p>
            <a id="linkA" target="_blank" style="color:var(--gold); font-size:12px;">View Map</a></div></div>
          </div>
          <div class="fate" id="cardB" onclick="handlePick('B')">
            <div class="fateInner"><div class="fateFace fateFront"><p class="fateTitle">Card B</p><span style="font-size:12px;color:var(--gold)">? tap to pick</span></div>
            <div class="fateFace fateBack"><div class="pickBadge">YOU CHOSE</div><p class="fateRevealTitle">漢來飯店一晚</p><p class="fateRevealMeta" id="metaB"></p>
            <a id="linkB" target="_blank" style="color:var(--gold); font-size:12px;">View Map</a></div></div>
          </div>
          <div id="cardC">
             <div class="fateRevealTitle" style="text-align:center;">Actually... ??</div>
             <p class="fateRevealMeta" style="text-align:center;" id="metaC"></p>
             <div class="receipt-wrapper">
               <div class="receipt-box"><img src="" id="imgA" class="receipt-img"><div class="stamp">CONFIRMED</div></div>
               <div class="receipt-box"><img src="" id="imgB" class="receipt-img"><div class="stamp">CONFIRMED</div></div>
             </div>
             <p style="margin-top:25px; font-family:var(--display); color:var(--gold); text-align:center; font-weight:bold;">Happy Birthday, Addie! ??</p>
          </div>
        </div>
        <div id="stepActions" style="display:none; justify-content:center; margin-top:25px;"><button class="primary" id="revealOtherBtn">看看另一個選項</button></div>
      </div>
    </section>
  </main>

  <script>
    const CONFIG = {
      to: "Addie",
      targetDate: "2026-03-06T00:00:00", // 精確到秒，確保倒數準確
      
      // ? 這裡貼上妳的 Google CSV 連結，用於進度條
      sheetUrl: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSXXXXXXXX/pub?output=csv", 
      
      // ? 地圖連結
      mapA: "https://www.google.com/maps/search/?api=1&query=A+CUT+Steakhouse",
      mapB: "https://www.google.com/maps/search/?api=1&query=Grand+Hi-Lai+Hotel+Taipei",
      
      // ? 圖片截圖連結
      receiptA: "妳的Discord圖片網址1",
      receiptB: "妳的Discord圖片網址2",
      
      // 內文語氣
      textA: "2026/3/6 19:00\n只要美美地出現就好??",
      textB: "2026/3/7 Check-in\n隔天還有島語早餐唷！",
      textC: "看妳在那邊選這麼久，其實我全都訂了啦！\n生日行程就是 A CUT 晚餐 + 漢來住一晚！",
      opening: `Pick a card ?? Choose your fate ?\n由命運決定你今年的生日怎麼過`,
      
      // ? 新增：何時開放 Check-in (妳出國的日期與時間)
      checkinOpenTime: "2024-07-20T10:00:00" // 例如：妳預計 2024/07/20 早上 10 點出國
    };

    let picked = null;
    let checkinInterval; // 用於儲存 checkin 倒數的 interval

    // Functions for existing features
    async function syncProgress() { /* ... (same as before) ... */ }
    function updateCountdown() { /* ... (same as before) ... */ }

    // 新增：Check-in 倒數邏輯
    function updateCheckinCountdown() {
      const now = new Date();
      const openTime = new Date(CONFIG.checkinOpenTime);
      const diff = openTime - now;

      if (diff <= 0) {
        clearInterval(checkinInterval);
        document.getElementById("countdownBeforeOpen").innerText = "Check-in 已開放！";
        document.getElementById("startJourneyBtn").innerText = "立即登機！"; // 按鈕文字變更
        document.getElementById("startJourneyBtn").onclick = openMainFlow; // 允許進入主流程
        return;
      }

      const d = Math.floor(diff / 86400000);
      const h = Math.floor((diff % 86400000) / 3600000);
      const m = Math.floor((diff % 3600000) / 60000);
      const s = Math.floor((diff % 60000) / 1000);

      document.getElementById("countdownBeforeOpen").innerText = 
        `還有 ${d}天 ${h}小時 ${m}分 ${s}秒 開放 Check-in`;
    }

    // 進入主流程 (顯示卡片、進度條等)
    function openMainFlow() {
      document.getElementById("mainTitle").style.display = "none"; // 隱藏大標題
      document.getElementById("boardingPass").style.display = "none";
      document.getElementById("airplaneScene").style.display = "none"; // 隱藏飛機畫面
      document.getElementById("flow").style.display = "block"; // 顯示主體內容
      
      document.getElementById("title").innerText = "Hi, " + CONFIG.to; // 這裡是主體的標題
      document.getElementById("openingText").innerText = CONFIG.opening;
      document.getElementById("linkA").href = CONFIG.mapA;
      document.getElementById("linkB").href = CONFIG.mapB;
      document.getElementById("imgA").src = CONFIG.receiptA;
      document.getElementById("imgB").src = CONFIG.receiptB;
      document.getElementById("metaA").innerText = CONFIG.textA;
      document.getElementById("metaB").innerText = CONFIG.textB;
      document.getElementById("metaC").innerText = CONFIG.textC;

      // 開始主體的自動更新
      setInterval(updateCountdown, 1000);
      setInterval(syncProgress, 30000);
      updateCountdown();
      syncProgress();
    }

    // Main logic on page load
    window.onload = () => {
      document.getElementById("startJourneyBtn").onclick = () => {
        document.getElementById("mainTitle").style.display = "none"; // 隱藏大標題
        document.getElementById("boardingPass").style.display = "none";
        document.getElementById("airplaneScene").style.display = "flex"; // 顯示飛機畫面

        // 啟動 Check-in 倒數
        updateCheckinCountdown();
        checkinInterval = setInterval(updateCheckinCountdown, 1000);
      };
    };

    function handlePick(id) {
      if (picked) return;
      picked = id;
      document.getElementById("card" + id).classList.add("revealed", "is-picked");
      document.getElementById("stepActions").style.display = "flex";
    }

    document.getElementById("revealOtherBtn").onclick = () => {
      const otherId = (picked === 'A') ? 'cardB' : 'cardA';
      document.getElementById(otherId).classList.add("revealed");
      document.getElementById("revealOtherBtn").style.display = "none";
      setTimeout(() => {
        const c = document.getElementById("cardC");
        c.classList.add("show");
        c.scrollIntoView({ behavior: "smooth", block: "center" });
      }, 3000);
    };
  </script>
</body>
</html>